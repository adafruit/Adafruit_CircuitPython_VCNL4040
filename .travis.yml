# This is a common .travis.yml for generating library release zip files for
# CircuitPython library releases using circuitpython-build-tools.
# See https://github.com/adafruit/circuitpython-build-tools for detailed setup
# instructions.

dist: xenial
language: python
python:
  - "3.6"

cache:
  pip: true

env:
  - DEPLOY_PYPI="true"

deploy:
  - provider: releases
    api_key: "$GITHUB_TOKEN"
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/bundles/*"
    skip_cleanup: true
    overwrite: true
    on:
      tags: true
  # TODO: Use 'travis encrypt --com -r adafruit/<repo slug>' to generate
  #       the encrypted password for adafruit-travis. Paste result below.
  - provider: pypi
    user: adafruit-travis
    password:
      secure: J/BVp5vHcmjpKFVmYCL0NoUqbk/TLwq1VtpF+EEvpzV+xEAelnwbnv49I27gUsRZH/mfBZi2KO+cTdVXAWCchXAo7QuPyHSnXdHLhmYmO5qRuClAE7Jyn8lYoScPpXhxV9jXg0kpq1CW1xetqxepPOqkT1+i+mL+Cb+2XurXv9kWSE+kzIdGIAAwbxPlgEPnUuNHCAjGBfzEWoCAk3BRT/31sfJ7K87awIcrYeOSxyl4H+uqCXRw5KvaleiW7sSu5Dgl+uwKUXnir/Nwm7eyrfF4N38Yf7sMmqiZxSMFrTsK9aDtr4NFfJvgKfXHKcdqdBXKFplOE7qILG/4WBSCXwO1Gep+sd2aQB6TJCg73Y/vh4skutIgigYKbqkZ7kZ8mFTlFxxRT1pTDf2qbcxUkwwjBGWQO9ORj8q8wwXQAMfMk5bxTgz3Vtqzbk0fruU2TswZu+LrgsLrVOh/gqBb302yiLhI9RzH+06M60JD59M0h1KvLIqJmaYI2oT2oguWpqnNeHLzC+yNx4IRe3IGrK2XF/OVzm9DzIAkgrCguZWq2ksx+RfTtwmRX0wtgUdpy+nCZDGDpWmG/xrC5PaMRTlA8QVK0dETjGs3wXxGxQyM8rjnxJ324+8LfrvT8/m8/AEjXQM/Y9Cv3sHI1hLW9UMPa8fLQFzuuAbNQuuV3Eo=
    on:
      tags: true
      condition: $DEPLOY_PYPI = "true"

install:
  - pip install -r requirements.txt
  - pip install circuitpython-build-tools Sphinx sphinx-rtd-theme
  - pip install --force-reinstall pylint==1.9.2

script:
  - pylint adafruit_vcnl4040.py
  - ([[ ! -d "examples" ]] || pylint --disable=missing-docstring,invalid-name,bad-whitespace examples/*.py)
  - circuitpython-build-bundles --filename_prefix adafruit-circuitpython-vcnl4040 --library_location .
  - cd docs && sphinx-build -E -W -b html . _build/html && cd ..
